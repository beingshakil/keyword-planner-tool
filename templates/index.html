<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Keyword Planner Dashboard for SEO research and keyword analysis">
    <meta name="theme-color" content="#4f46e5" id="theme-color">
    <meta name="color-scheme" content="light dark">
    <title>Keyword Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <style>
        /* Sheet selector dropdown styles */
        .sheet-selector-wrapper {
            display: inline-block;
            position: relative;
            margin-right: 0.5rem;
        }
        
        .sheet-dropdown-wrapper {
            position: relative;
            display: inline-block;
        }
        
        #sheet-selector {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            padding-right: 1.5rem;
        }
        
        /* Custom project file item style */
        .project-file-item {
            background-color: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #1e293b; 
            border-radius: 0.375rem;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .dark-mode .project-file-item {
            background-color: #334155;
            border-color: #475569;
            color: #f1f5f9;
        }
        
        /* Fix dark mode toggle button */
        .dark-mode-toggle {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: none;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.2s ease;
        }
        
        .dark-mode-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        .dark-mode .dark-mode-toggle {
            background-color: #60a5fa;
        }
        
        /* Force table header to be sticky */
        .table-header {
            position: sticky !important;
            top: 0 !important;
            z-index: 20 !important;
        }
        
        /* Fix checkbox alignment */
        input[type="checkbox"] {
            display: block !important;
            margin: 0 auto !important;
        }
        
        /* Improved column spacing */
        .table-compact th:nth-child(3),
        .table-compact td:nth-child(3) {
            padding-left: 1.5rem !important;
            padding-right: 1.5rem !important;
            text-align: center !important;
        }
        
        .table-compact th:nth-child(4), 
        .table-compact td:nth-child(4) {
            padding-left: 1.5rem !important;
            padding-right: 1.5rem !important;
            text-align: center !important;
        }
        
        /* Fix file visibility */
        #project-file-list {
            background-color: #ffffff !important;
            border: 1px solid #e2e8f0 !important;
            padding: 0.5rem !important;
            border-radius: 0.375rem !important;
        }
        
        .dark-mode #project-file-list {
            background-color: #1e293b !important;
            border-color: #334155 !important;
        }
        
        @media (prefers-color-scheme: dark) {
            body:not(.light-mode) {
                background-color: var(--dark-bg);
                color: var(--dark-text);
            }
        }
    </style>
</head>

<body class="bg-slate-50">
    <!-- Dark mode toggle button -->
    <button id="dark-mode-toggle" class="dark-mode-toggle">
        <i class="fas fa-moon"></i>
    </button>

    <!-- MAIN: Mobile Navigation Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden sidebar-overlay lg:hidden"></div>

    <!-- MAIN: Sidebar with improved styling -->
    <aside id="sidebar"
        class="sidebar fixed top-0 left-0 h-full shadow-sm">
        <!-- MAIN: Logo Section -->
        <div class="p-4 flex justify-between items-center border-b border-slate-200">
            <div class="flex items-center">
                <i class="fas fa-chart-line text-indigo-600 text-xl"></i>
                <span class="ml-2.5 font-semibold text-lg project-name">KeywordPlanner</span>
            </div>
            <!-- MAIN: Mobile Close Button -->
            <button id="sidebar-close" class="lg:hidden text-slate-500 hover:text-slate-700 focus:outline-none">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Add after the logo section, inside the sidebar -->
        <div class="p-3 border-b border-slate-200">
            <div class="flex justify-between items-center mb-1.5">
                <h5 class="text-xs font-semibold text-slate-500 uppercase tracking-wider">Project</h5>
                <button id="create-project-btn" class="text-slate-400 hover:text-slate-600" title="Create New Project">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="relative">
                <select id="project-selector" class="w-full bg-white text-slate-700 border border-slate-200 rounded-lg py-1.5 px-2.5 text-sm appearance-none">
                    <option value="default">Default Project</option>
                </select>
                <div class="absolute inset-y-0 right-8 flex items-center pointer-events-none">
                    <i class="fas fa-chevron-down text-xs text-slate-400"></i>
                </div>
                <div class="absolute inset-y-0 right-8 flex items-center">
                    <button id="rename-project-btn" class="px-1.5 text-slate-400 hover:text-slate-600" title="Rename Project">
                        <i class="fas fa-edit text-sm"></i>
                    </button>
                </div>
                <button id="delete-project-btn" class="absolute right-0 top-0 h-full px-2 text-slate-400 hover:text-red-500" title="Delete Current Project">
                    <i class="fas fa-trash-alt text-sm"></i>
                </button>
            </div>
            <div id="project-file-list" class="mt-2 max-h-40 overflow-y-auto">
                <!-- Imported files will be listed here -->
            </div>
            <button id="import-file-btn" class="mt-2 text-xs bg-white hover:bg-slate-50 text-slate-700 transition-colors py-1.5 px-3 rounded-lg w-full flex items-center justify-center border border-slate-200">
                <i class="fas fa-file-upload mr-1.5"></i> Import File
            </button>
            <input type="file" id="file-upload-input" accept=".csv, .xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel, text/csv" class="hidden">
        </div>

        <!-- MAIN: Navigation Links -->
        <nav class="p-3">
            <h5 class="sidebar-section-header">Views</h5>
            <ul>
                <li>
                    <a href="#" id="main-table-view"
                        class="sidebar-menu-item active flex items-center">
                        <i class="fas fa-table item-icon"></i>
                        <span class="ml-2">Main Table</span>
                    </a>
                </li>
                <li>
                    <!-- SAVED KEYWORDS: Sidebar Navigation Link -->
                    <a href="#" id="saved-keywords-view"
                        class="sidebar-menu-item flex items-center">
                        <i class="fas fa-star item-icon"></i>
                        <span class="ml-2">Saved Keywords</span>
                    </a>
                </li>
            </ul>

            <!-- SAVED KEYWORDS: Sidebar List of Saved Keyword Lists -->
            <h5 class="sidebar-section-header mt-5 mb-2">Saved Keyword Lists</h5>
            <ul id="saved-keyword-lists" class="max-h-[calc(100vh-400px)] overflow-y-auto mb-2 pr-1 space-y-0.5">
                <!-- Saved keyword lists will be dynamically added here -->
                <li class="text-xs text-slate-500 px-2.5 py-1.5">
                    No saved lists yet
                </li>
            </ul>
            <!-- SAVED KEYWORDS: Create New List Button in Sidebar -->
            <button id="create-new-list"
                class="mt-2 text-xs bg-white hover:bg-slate-50 text-slate-700 transition-colors py-1.5 px-3 rounded-lg w-full flex items-center justify-center border border-slate-200">
                <i class="fas fa-plus mr-1.5"></i> Create New List
            </button>
        </nav>

        <!-- MAIN: Collapse Button (only visible on desktop) -->
        <div class="absolute bottom-4 right-4 hidden lg:block">
            <button id="sidebar-collapse"
                class="sidebar-collapse-btn">
                <i id="collapse-icon" class="fas fa-chevron-left text-xs"></i>
            </button>
        </div>
    </aside>

    <!-- MAIN: Main Content with improved layout -->
    <div id="content-area" class="content-area min-h-screen lg:ml-[240px] p-4 md:p-6">
        <!-- MAIN: Mobile Header with Toggle Button -->
        <header class="flex items-center justify-between lg:hidden bg-white border-b border-slate-200 p-3 sticky top-0 z-20 mb-4 rounded-lg shadow-sm">
            <button id="sidebar-toggle" class="text-slate-700 focus:outline-none">
                <i class="fas fa-bars text-lg"></i>
            </button>
            <h1 class="text-lg font-semibold project-name">Keyword Planner</h1>
            <div class="w-6"></div> <!-- Empty div for flex spacing -->
        </header>

        <!-- MAIN: Main Table View -->
        <div id="main-table-content" class="container mx-auto">
            <!-- Current File Info and Sheet Selector -->
            <div class="flex items-center justify-between py-2 mb-4 border-b border-slate-200 hidden">
                <div class="flex items-center">
                    <div class="text-sm font-medium text-slate-700">
                        <span class="mr-2">Currently viewing:</span>
                        <span id="current-file-name" class="font-bold text-indigo-700">Demo - Copy</span>
                    </div>
                </div>
                <div class="flex items-center">
                    <!-- Sheet Selector Dropdown -->
                    <div id="sheet-selector-container" class="sheet-selector-wrapper relative inline-block mr-2"></div>
                    <button id="return-to-main-btn" class="text-sm text-indigo-600 hover:text-indigo-800 px-3 py-1.5 rounded-lg border border-indigo-200 hover:bg-indigo-50">
                        Return to Main Data
                    </button>
                </div>
            </div>

            <!-- MAIN: Search and filter section with improved layout -->
            <div class="flex flex-col mb-5 main-header-section">
                <!-- MAIN: Currently viewing section -->

                <!-- MAIN: Search section with improved layout -->
                <div class="mb-4">
                    <div class="flex flex-wrap md:flex-nowrap gap-2">
                        <!-- MAIN: Search input with cleaner styling -->
                        <div class="relative flex-grow">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-search text-slate-400"></i>
                            </div>
                            <input type="text" id="searchInput"
                                class="search-input block w-full pl-10 pr-10 py-2 bg-white border border-slate-200 rounded-lg focus:outline-none text-slate-800 focus:border-blue-500"
                                placeholder="Type to search keywords...">
                            <button id="clearSearchBtn"
                                class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer hidden">
                                <i class="fas fa-times text-slate-400 hover:text-slate-600"></i>
                            </button>
                        </div>

                        <!-- MAIN: Search type dropdown with cleaner styling -->
                        <div class="w-full md:w-auto">
                            <select id="searchTypeSelect"
                                class="block w-full px-4 py-2 bg-white border border-slate-200 rounded-lg focus:outline-none text-slate-800 focus:border-blue-500 appearance-none"
                                title="Search Match Type">
                                <option value="partial">Partial</option>
                                <option value="exact">Exact</option>
                                <option value="startsWith">Starts With</option>
                                <option value="endsWith">Ends With</option>
                            </select>
                        </div>

                        <!-- MAIN: Match percentage input with cleaner styling -->
                        <div class="relative ml-2 w-16 flex-shrink-0">
                            <input type="number" id="threshold"
                                class="block w-full px-2 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm shadow-sm text-center"
                                placeholder="%" min="0" max="100" value="70" title="Match Threshold Percentage">
                            <span id="thresholdValue"
                                class="absolute right-2 inset-y-0 flex items-center text-sm font-medium text-slate-500">%</span>
                        </div>

                        <!-- MAIN: Search button with improved styling -->
                        <button id="searchButton"
                            class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg shadow-sm hover:shadow transition-all duration-200 flex items-center justify-center ml-2 text-sm">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

                <!-- MAIN: Actions section with improved spacing -->
                <div class="flex items-center gap-2 py-1 justify-end">
                    <!-- MAIN: Volume filter dropdown with improved styling -->
                    <div class="flex-shrink-0 relative">
                        <button id="main-volume-filter-btn"
                            class="flex items-center justify-between px-3 py-2 border border-slate-200 rounded-lg focus:outline-none shadow-sm hover:bg-slate-50 transition-all duration-150 text-sm">
                            <div class="flex items-center">
                                <i class="fas fa-filter text-slate-400 mr-1.5"></i>
                                <span id="main-volume-filter-label" class="text-sm">All Volumes</span>
                            </div>
                            <i class="fas fa-chevron-down text-xs text-slate-400 ml-1.5"></i>
                        </button>
                        <div id="main-volume-filter-dropdown" class="absolute right-0 mt-1 bg-white border border-slate-200 rounded-lg shadow-lg z-50 hidden">
                            <div class="filter-option" data-filter="">All Volumes</div>
                            <div class="filter-option" data-filter="blank">Blank</div>
                            <div class="filter-option" data-filter="10K-100K">10K-100K</div>
                            <div class="filter-option" data-filter="100K-1M">100K-1M</div>
                            <div class="filter-option" data-filter="1M-10M">1M-10M</div>
                        </div>
                    </div>

                    <!-- Action buttons with improved styling -->
                    <div class="flex items-center gap-2">
                        <!-- MAIN: Copy Selected button -->
                        <button id="copyBtn"
                            class="action-btn"
                            title="Copy Selected">
                            <i class="fas fa-copy"></i>
                            <span class="tooltip opacity-0 group-hover:opacity-100 absolute -top-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs py-1.5 px-3 rounded-md transition-opacity duration-200 whitespace-nowrap shadow-md">
                                Copy Selected
                            </span>
                        </button>

                        <!-- MAIN: Export Selected button -->
                        <button id="exportBtn"
                            class="action-btn primary"
                            title="Export Selected">
                            <i class="fas fa-download"></i>
                            <span class="tooltip opacity-0 group-hover:opacity-100 absolute -top-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs py-1.5 px-3 rounded-md transition-opacity duration-200 whitespace-nowrap shadow-md">
                                Export Selected
                            </span>
                        </button>

                        <!-- SAVED KEYWORDS: Save Selected Keywords Button -->
                        <button id="save-selected-btn"
                            class="action-btn"
                            title="Save Selected Keywords">
                            <i class="fas fa-bookmark"></i>
                            <span class="tooltip opacity-0 group-hover:opacity-100 absolute -top-10 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white text-xs py-1.5 px-3 rounded-md transition-opacity duration-200 whitespace-nowrap shadow-md">
                                Save Selected
                            </span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- MAIN: Selected count and page size controls - improved spacing -->
            <div class="table-actions-sticky flex justify-between items-center gap-3 mb-4">
                <!-- MAIN: Selected Count Display -->
                <div class="flex items-center">
                    <div id="selected-count-container" class="text-sm font-medium text-slate-600 flex items-center"
                        style="display: none;"> <!-- Initially hidden -->
                        <span>Selected <span id="selectedCount" class="font-bold">0</span> items</span>
                        <button id="deselect-btn"
                            class="ml-3 text-sm text-indigo-600 hover:text-indigo-800 hover:underline focus:outline-none">
                            Deselect All
                        </button>
                    </div>
                </div>
                <!-- MAIN: Page Size Controls -->
                <div class="flex justify-end gap-2 items-center">
                    <label for="main-page-size-input" class="text-sm text-slate-600">Items per page:</label>
                    <input id="main-page-size-input" type="number" min="10" max="1000"
                        class="w-16 px-2 py-1.5 border border-slate-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-indigo-500 text-sm text-center"
                        value="100">
                </div>
            </div>

            <!-- MAIN: Main Keywords Table -->
            <div class="table-container overflow-x-auto bg-white rounded-xl shadow-sm border border-slate-100">
                <table class="min-w-full w-full table-compact border-collapse">
                    <colgroup>
                        <col class="col-checkbox">
                        <col class="col-keyword">
                        <col class="col-volume">
                        <col class="col-value">
                    </colgroup>
                    <thead class="table-header">
                        <tr>
                            <th class="text-left">
                                <div class="flex items-center justify-center">
                                    <input type="checkbox" id="selectAll"
                                        class="w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                </div>
                            </th>
                            <th class="text-left sortable" data-sort="keyword">
                                <span class="flex items-center">
                                    <span class="font-semibold text-slate-700">Keyword</span>
                                    <i class="fas fa-sort ml-2 text-slate-400 text-xs"></i>
                                </span>
                            </th>
                            <th class="text-left sortable" data-sort="volume">
                                <span class="flex items-center">
                                    <span class="font-semibold text-slate-700">Volume</span>
                                    <i class="fas fa-sort ml-2 text-slate-400 text-xs"></i>
                                </span>
                            </th>
                            <th class="text-left sortable" data-sort="value">
                                <span class="flex items-center justify-center">
                                    <span class="font-semibold text-slate-700">KD</span>
                                    <i class="fas fa-sort ml-2 text-slate-400 text-xs"></i>
                                </span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="keywordsTableBody">
                        <!-- MAIN: Keywords will be loaded here -->
                    </tbody>
                </table>

                <!-- MAIN: Pagination Controls -->
                <div id="pagination-controls" class="p-3 hidden">
                    <!-- MAIN: Pagination will be added here dynamically -->
                </div>
            </div>
        </div>

        <!-- SAVED KEYWORDS: Saved Keywords View -->
        <div id="saved-keywords-content" class="container mx-auto hidden">
            <!-- SAVED KEYWORDS: No saved lists view -->
            <div id="no-saved-lists" class="py-12 flex flex-col items-center justify-center text-center">
                <div class="bg-indigo-100 p-4 rounded-full mb-4">
                    <i class="fas fa-bookmark text-indigo-500 text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold text-slate-800 mb-2">No Saved Keyword Lists Yet</h2>
                <p class="text-slate-600 mb-5 max-w-md">Save your important keywords to organize your research</p>
                <button id="create-list-btn"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-5 rounded-lg font-medium transition-colors duration-200 flex items-center">
                    <i class="fas fa-plus mr-2"></i> Create Your First List
                </button>
            </div>

            <!-- SAVED KEYWORDS: Saved lists content -->
            <div id="saved-lists-content" class="hidden">
                <!-- SAVED KEYWORDS: Lists tabs section -->
                <div class="mb-5 border-b border-slate-200">
                    <ul id="keyword-list-tabs" class="flex flex-wrap -mb-px">
                        <!-- SAVED KEYWORDS: List tabs will be dynamically added here -->
                    </ul>
                </div>

                <!-- SAVED KEYWORDS: Active list content -->
                <div id="active-list-content">
                    <!-- SAVED KEYWORDS: List info and actions -->
                    <div class="sticky-header-container border-b border-slate-200 pb-3 mb-4 flex flex-col sm:flex-row justify-between sm:items-center gap-3">
                        <div>
                            <h2 class="text-lg font-semibold text-slate-800" id="active-list-name">List Name</h2>
                            <p class="text-slate-500 text-sm mt-0.5" id="active-list-count">0 keywords</p>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <!-- SAVED KEYWORDS: Volume filter dropdown with improved structure -->
                            <div class="relative z-30">
                                <button id="volume-filter-btn"
                                    class="bg-white hover:bg-slate-50 py-1.5 px-3 rounded border border-slate-200 text-slate-700 text-sm font-medium flex items-center gap-1.5">
                                    <i class="fas fa-filter text-slate-400"></i>
                                    <span id="volume-filter-label">Volume Filter</span>
                                    <i class="fas fa-chevron-down text-xs ml-1 text-slate-400"></i>
                                </button>
                                <div id="volume-filter-dropdown" class="hidden">
                                    <div class="filter-option" data-filter="">All Volumes</div>
                                    <div class="filter-option" data-filter="blank">Blank</div>
                                    <div class="filter-option" data-filter="10K-100K">10K-100K</div>
                                    <div class="filter-option" data-filter="100K-1M">100K-1M</div>
                                    <div class="filter-option" data-filter="1M-10M">1M-10M</div>
                                </div>
                            </div>
                            <!-- SAVED KEYWORDS: List action buttons -->
                            <button id="edit-list-name"
                                class="text-indigo-600 hover:bg-indigo-50 py-1.5 px-3 rounded-lg text-sm transition-colors duration-200 flex items-center">
                                <i class="fas fa-edit mr-1.5"></i> Rename
                            </button>
                            <button id="export-list"
                                class="bg-indigo-600 hover:bg-indigo-700 text-white py-1.5 px-3 rounded-lg text-sm transition-colors duration-200">
                                <i class="fas fa-download mr-1.5"></i> Export
                            </button>
                            <button id="delete-list"
                                class="bg-white hover:bg-red-50 text-red-600 border border-red-200 py-1.5 px-3 rounded-lg text-sm transition-colors duration-200">
                                <i class="fas fa-trash-alt mr-1.5"></i> Delete
                            </button>
                        </div>
                    </div>

                    <!-- SAVED KEYWORDS: Keywords table -->
                    <div class="flex mt-6 flex-col gap-4">
                        <!-- SAVED KEYWORDS: Search and Page Size Controls -->
                        <div class="search-controls-sticky flex items-center justify-between mt-4 mb-4">
                            <!-- SAVED KEYWORDS: Search Input -->
                            <div class="relative w-1/3">
                                <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                                    <i class="fas fa-search text-slate-400"></i>
                                </span>
                                <input id="saved-keyword-search" type="text"
                                    class="w-full px-3 py-2.5 pl-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                                    placeholder="Search saved keywords...">
                            </div>

                            <!-- SAVED KEYWORDS: Page Size Control -->
                            <div id="page-size-control" class="flex items-center">
                                <label for="page-size-input" class="mr-2 text-sm text-gray-700">Items per page:</label>
                                <input id="page-size-input" type="number" min="10" max="500"
                                    class="w-20 px-3 py-1.5 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    value="50">
                            </div>
                        </div>
                        <div
                            class="table-container bg-white border border-slate-100 rounded-xl shadow-md overflow-hidden">

                            <table class="min-w-full w-full table-fixed border-collapse table-compact">
                                <colgroup>
                                    <col class="col-checkbox">
                                    <col class="col-keyword">
                                    <col class="col-volume">
                                    <col class="col-value">
                                    <col class="col-action">
                                </colgroup>
                                <thead class="table-header">
                                    <tr>
                                        <th class="text-left">
                                            <div class="flex items-center justify-center">
                                                <input type="checkbox" id="selectAllSaved"
                                                    class="w-4 h-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                                            </div>
                                        </th>
                                        <th class="text-left cursor-pointer" data-sort="keyword">
                                            <span class="flex items-center">
                                                <span>Keyword</span>
                                                <i class="fas fa-sort ml-2 text-slate-400"></i>
                                            </span>
                                        </th>
                                        <th class="text-left cursor-pointer" data-sort="volume">
                                            <span class="flex items-center">
                                                <span>Volume</span>
                                                <i class="fas fa-sort ml-2 text-slate-400"></i>
                                            </span>
                                        </th>
                                        <th class="text-left cursor-pointer" data-sort="value">
                                            <span class="flex items-center justify-center">
                                                <span>KD</span>
                                                <i class="fas fa-sort ml-2 text-slate-400"></i>
                                            </span>
                                        </th>
                                        <th class="text-center">
                                            <span>Action</span>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="savedKeywordsTableBody">
                                    <!-- SAVED KEYWORDS: Saved keywords will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- SAVED KEYWORDS: Pagination container -->
                    <div id="keywords-pagination" class="mt-4 hidden">
                        <!-- SAVED KEYWORDS: Pagination will be added dynamically -->
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- SAVED KEYWORDS: Create New List Modal -->
    <div id="create-list-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-800">Create New List</h2>
                <button id="close-modal" class="text-slate-500 hover:text-slate-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label for="list-name" class="block text-sm font-medium text-slate-700 mb-2">
                    List Name
                </label>
                <input type="text" id="list-name"
                    class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="Enter a name for your list">
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancel-create-list"
                    class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                    Cancel
                </button>
                <button id="confirm-create-list"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                    Create List
                </button>
            </div>
        </div>
    </div>

    <!-- SAVED KEYWORDS: Save to List Modal -->
    <div id="save-to-list-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-800">Save to List</h2>
                <button id="close-save-modal" class="text-slate-500 hover:text-slate-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <p class="text-sm text-slate-600 mb-2"><span id="selected-keywords-count">0</span> keywords selected</p>
                <div id="save-to-existing-list" class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 mb-2">
                        Choose a list
                    </label>
                    <select id="existing-lists"
                        class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <!-- SAVED KEYWORDS: Existing lists will be added here -->
                    </select>
                </div>
                <div class="flex items-center mb-4">
                    <hr class="flex-grow border-slate-200">
                    <span class="px-3 text-xs text-slate-500">OR</span>
                    <hr class="flex-grow border-slate-200">
                </div>
                <div id="create-new-list-option">
                    <label for="new-list-name" class="block text-sm font-medium text-slate-700 mb-2">
                        Create a new list
                    </label>
                    <input type="text" id="new-list-name"
                        class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Enter a name for your new list">
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancel-save-to-list"
                    class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                    Cancel
                </button>
                <button id="confirm-save-to-list"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                    Save Keywords
                </button>
            </div>
        </div>
    </div>

    <!-- SAVED KEYWORDS: Rename List Modal -->
    <div id="rename-list-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-800">Rename List</h2>
                <button id="close-rename-modal" class="text-slate-500 hover:text-slate-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <label for="rename-list-input" class="block text-sm font-medium text-slate-700 mb-2">
                    New List Name
                </label>
                <input type="text" id="rename-list-input"
                    class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    placeholder="Enter a new name for this list">
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancel-rename-list"
                    class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                    Cancel
                </button>
                <button id="confirm-rename-list"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                    Rename List
                </button>
            </div>
        </div>
    </div>

    <!-- SAVED KEYWORDS: Delete List Confirmation Modal -->
    <div id="delete-list-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-800">Delete List</h2>
                <button id="close-delete-modal" class="text-slate-500 hover:text-slate-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-6">
                <div class="mb-4 text-center">
                    <div
                        class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-100 text-red-500 mb-4">
                        <i class="fas fa-exclamation-triangle text-xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-slate-900 mb-2">Are you sure?</h3>
                    <p class="text-sm text-slate-600">
                        You are about to delete "<span id="delete-list-name" class="font-medium"></span>".
                        This list contains <span id="delete-list-count" class="font-medium"></span> keywords.
                        This action cannot be undone.
                    </p>
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancel-delete-list"
                    class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                    Cancel
                </button>
                <button id="confirm-delete-list"
                    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200">
                    Delete List
                </button>
            </div>
        </div>
    </div>

    <!-- All Volumes Filter Button with proper structure -->
    <div class="relative">
        <button id="all-volumes-btn" type="button" class="inline-flex items-center gap-1 px-2 py-1.5 border border-slate-200 rounded-lg text-slate-600 bg-white hover:bg-slate-50 focus:outline-none">
            <i class="fas fa-filter text-slate-400"></i>
            <span>All Volumes</span>
            <i class="fas fa-chevron-down text-xs text-slate-400 ml-1"></i>
        </button>
        <div id="all-volumes-dropdown" class="absolute right-0 mt-1 w-40 bg-white border border-slate-200 rounded-lg shadow-lg z-50 hidden">
            <div class="p-1">
                <button type="button" class="volume-option w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded" data-value="all">All Volumes</button>
                <button type="button" class="volume-option w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded" data-value="blank">Blank</button>
                <button type="button" class="volume-option w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded" data-value="10K-100K">10K-100K</button>
                <button type="button" class="volume-option w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded" data-value="100K-1M">100K-1M</button>
                <button type="button" class="volume-option w-full text-left px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded" data-value="1M-10M">1M-10M</button>
            </div>
        </div>
    </div>

    <!-- Basic Modal Template for Project Rename -->
    <div id="rename-project-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-slate-800">Rename Project</h2>
                <button type="button" id="close-rename-modal" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <label for="new-project-name" class="block text-sm font-medium text-slate-700 mb-2">New Project Name</label>
                <input type="text" id="new-project-name" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            
            <div class="flex justify-end gap-3">
                <button type="button" id="cancel-rename-project" class="px-4 py-2 text-sm font-medium border border-slate-300 rounded-md text-slate-700 hover:bg-slate-50">
                    Cancel
                </button>
                <button type="button" id="confirm-rename-project" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                    Rename Project
                </button>
            </div>
        </div>
    </div>

    <!-- Basic Modal Template for Create Project -->
    <div id="create-project-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-slate-800">Create New Project</h2>
                <button type="button" id="close-create-modal" class="text-slate-400 hover:text-slate-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-6">
                <label for="project-name" class="block text-sm font-medium text-slate-700 mb-2">Project Name</label>
                <input type="text" id="project-name" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter a name for your project">
            </div>
            
            <div class="flex justify-end gap-3">
                <button type="button" id="cancel-create-project" class="px-4 py-2 text-sm font-medium border border-slate-300 rounded-md text-slate-700 hover:bg-slate-50">
                    Cancel
                </button>
                <button type="button" id="confirm-create-project" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700">
                    Create Project
                </button>
            </div>
        </div>
    </div>

    <!-- Add this modal for file import confirmation -->
    <div id="file-import-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl shadow-xl p-6 w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-800">Import File</h2>
                <button id="close-import-modal" class="text-slate-500 hover:text-slate-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mb-4">
                <p class="text-sm text-slate-600 mb-2" id="file-info-text">File: <span id="import-filename">No file selected</span></p>
                <label for="import-file-name" class="block text-sm font-medium text-slate-700 mb-2">
                    Display Name
                </label>
                <input type="text" id="import-file-name" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter a name for this file">
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancel-import-file" class="px-4 py-2 border border-slate-300 text-slate-700 rounded-lg hover:bg-slate-50 transition-colors duration-200">
                    Cancel
                </button>
                <button id="confirm-import-file" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200">
                    Import File
                </button>
            </div>
        </div>
    </div>

    <!-- PROJECT FILE LIST ITEM TEMPLATE (hidden, will be used by JavaScript) -->
    <template id="project-file-item-template">
        <div class="project-file-item">
            <div>
                <i class="fas fa-file-alt mr-2"></i>
                <span class="filename"></span>
            </div>
            <div>
                <button class="delete-file-btn text-slate-400 hover:text-red-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </template>

    <!-- MAIN: Scripts -->
    <!-- Update Excel library with better compatibility and fallback -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <!-- Add fallback for Excel library -->
    <script>
        if (typeof XLSX === 'undefined') {
            // Create a fallback script if the primary CDN fails
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"><\/script>');
        }
    </script>
    <script src="{{ url_for('static', filename='js/dark-mode.js') }}"></script>
    <script src="{{ url_for('static', filename='js/saved-keywords.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/project-manager.js') }}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Add favicon to the tab
            const favicon = document.createElement('link');
            favicon.rel = 'icon';
            favicon.href = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="0.9em" font-size="90">📊</text></svg>';
            document.head.appendChild(favicon);
            
            // This would make the tab title more descriptive with project name if available
            if (window.currentProject) {
                document.title = `${window.currentProject} - Keyword Planner`;
            }
            
            // Sidebar functionality
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarClose = document.getElementById('sidebar-close');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const contentArea = document.getElementById('content-area');
            const sidebarCollapse = document.getElementById('sidebar-collapse');
            const collapseIcon = document.getElementById('collapse-icon');

            // Toggle sidebar on mobile
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', function () {
                    sidebar.classList.add('open');
                    sidebarOverlay.classList.remove('hidden');
                    document.body.classList.add('overflow-hidden'); // Prevent scrolling
                });
            }

            // Close sidebar on mobile
            if (sidebarClose) {
                sidebarClose.addEventListener('click', function () {
                    sidebar.classList.remove('open');
                    sidebarOverlay.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                });
            }

            // Close sidebar when clicking overlay
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', function () {
                    sidebar.classList.remove('open');
                    sidebarOverlay.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                });
            }

            // Collapse sidebar on desktop
            if (sidebarCollapse) {
                sidebarCollapse.addEventListener('click', function () {
                    sidebar.classList.toggle('w-64');
                    sidebar.classList.toggle('w-20');
                    contentArea.classList.toggle('lg:ml-64');
                    contentArea.classList.toggle('lg:ml-20');

                    // Toggle visibility of text and change icon direction
                    const menuTexts = document.querySelectorAll('.sidebar-menu-item span');
                    menuTexts.forEach(span => {
                        span.classList.toggle('hidden');
                    });

                    collapseIcon.classList.toggle('fa-chevron-left');
                    collapseIcon.classList.toggle('fa-chevron-right');
                });
            }

            // Handle active menu item
            const menuItems = document.querySelectorAll('.sidebar-menu-item');
            menuItems.forEach(item => {
                item.addEventListener('click', function () {
                    // Remove active class from all items
                    menuItems.forEach(i => i.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');

                    // On mobile, close the sidebar after selection
                    if (window.innerWidth < 1024) {
                        sidebar.classList.remove('open');
                        sidebarOverlay.classList.add('hidden');
                        document.body.classList.remove('overflow-hidden');
                    }
                });
            });
        });
    </script>

    <!-- Fix for dark mode and table headers -->
    <script>
        // Ensure dark mode toggle works
        window.addEventListener('load', function() {
            // Fix for dark mode button - ensure it works immediately
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            if (darkModeToggle) {
                // Make sure click handler is working
                darkModeToggle.onclick = function() {
                    document.body.classList.toggle('dark-mode');
                    const isDark = document.body.classList.contains('dark-mode');
                    localStorage.setItem('darkMode', isDark);
                    
                    // Update icon
                    this.innerHTML = isDark 
                        ? '<i class="fas fa-sun"></i>' 
                        : '<i class="fas fa-moon"></i>';
                    
                    // Update theme color
                    const themeColorMeta = document.getElementById('theme-color');
                    if (themeColorMeta) {
                        themeColorMeta.setAttribute('content', isDark ? '#0f172a' : '#4f46e5');
                    }
                    
                    // Force update colors
                    if (isDark) {
                        document.querySelectorAll('th, td').forEach(el => {
                            el.style.color = '#f1f5f9';
                        });
                    }
                };
                
                // Apply dark mode from localStorage on page load
                const isDarkMode = localStorage.getItem('darkMode') === 'true';
                if (isDarkMode) {
                    document.body.classList.add('dark-mode');
                    darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                    
                    // Force text colors for dark mode
                    document.querySelectorAll('th, td').forEach(el => {
                        el.style.color = '#f1f5f9';
                    });
                }
            }
            
            // Fix for modal background highlight issue
            document.querySelectorAll('.modal, #create-list-modal, #save-to-list-modal, #rename-list-modal, #delete-list-modal').forEach(modal => {
                if (modal) {
                    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
                }
            });
            
            // Fix for KD column header - make sure it always displays "KD" not "Value"
            const fixKDColumnHeader = function() {
                const valueHeaders = document.querySelectorAll('th[data-sort="value"] .font-semibold, th[data-sort="value"] span:first-child');
                valueHeaders.forEach(header => {
                    if (header && header.textContent !== 'KD') {
                        header.textContent = 'KD';
                    }
                });
            };
            
            // Call it initially and when tables are loaded/reloaded
            fixKDColumnHeader();
            setInterval(fixKDColumnHeader, 1000); // Check periodically
        });
    </script>

    <!-- Additional script to immediately fix KD column alignment -->
    <script>
        // Fix KD column alignment as soon as the DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Fix function that runs immediately and periodically
            function fixKDColumnAlignment() {
                // KD column in saved keywords
                const kdColumn = document.querySelector('#active-list-content th[data-sort="value"]');
                if (kdColumn) {
                    kdColumn.style.textAlign = 'center';
                    kdColumn.style.paddingLeft = '2rem';
                    kdColumn.style.paddingRight = '2rem';
                    
                    const span = kdColumn.querySelector('span');
                    if (span) {
                        span.style.display = 'flex';
                        span.style.justifyContent = 'center';
                        span.style.alignItems = 'center';
                        
                        const icon = span.querySelector('i');
                        if (icon) {
                            icon.style.display = 'inline-block';
                            icon.style.marginLeft = '8px';
                            icon.style.visibility = 'visible';
                        }
                    }
                }
                
                // Values in KD column
                const kdCells = document.querySelectorAll('#savedKeywordsTableBody td:nth-child(4)');
                kdCells.forEach(cell => {
                    cell.style.textAlign = 'center';
                    cell.style.paddingLeft = '2rem';
                    cell.style.paddingRight = '2rem';
                    cell.style.fontWeight = '500';
                });
            }
            
            // Run immediately
            fixKDColumnAlignment();
            
            // Also run when saved keywords tab is clicked
            document.querySelector('#saved-keywords-view')?.addEventListener('click', function() {
                setTimeout(fixKDColumnAlignment, 100);
            });
            
            // Run periodically
            setInterval(fixKDColumnAlignment, 300);
        });
    </script>
</body>

</html>
